## overview 
---
**Date:** January 28, 2025  
**Source:** [malware-traffic-analysis.net](https://www.malware-traffic-analysis.net/2025/01/28/index.html)

On January 28, 2025, a compromised website injected malicious scripts into a visitor's browser, leading to a multi-stage infection involving KongTuke (PowerShell) and SocGholish (fake browser update). This scenario walks through the end-to-end incident â€” from detection to recovery.

---
---
### Step 1: Download and Extract Investigation Materials.

- Downloaded the PCAP, malware files, and IOC list from [malware-traffic-analysis.net](https://www.malware-traffic-analysis.net/2025/01/28/index.html)
- Extracted files using the password: `infected_20250128`

![image](https://github.com/user-attachments/assets/77946a0e-c8ef-4bcb-b42c-b5fb57667ab5)

What we  Got
- `web-inject-and-malware-infection.pcap`
- `Update.zip â†’ Update.js`
- IOC file with URLs, hashes, and infection behavior

 What It Means
The data includes real malware communication and payloads. These files serve as the foundation for threat hunting, IOC extraction, and IR simulation.

---

### Step 2: Analyze PCAP File (Wireshark)

- Opened the PCAP in **Wireshark**
- Used filters:
  - `http`
  - `ip.addr == 147.45.47.98`
  - `frame contains "update"`
  - `tcp.port == 25658`
---

![Screenshot 2025-07-10 141703](https://github.com/user-attachments/assets/15eb05fd-35ae-4c74-a739-2ff2565cb2bd)


| **Observation**                                     | **Explanation**                                                                 |
|-----------------------------------------------------|----------------------------------------------------------------------------------|
| `/f%20mzioj%20m.php?s=578`, `/nexdplitf0htr.php?...`| These are seen as GET requests from IP `45.61.136.218`. Likely C2 endpoints or malware delivery URLs. |
| `/robots.txt`, `/connecttest.txt`                   | Normal system/browser activity â€” used as environmental background noise.        |
| `/update/.../pinrulessl1.cab`                       | Seen in `GET` request. Fake file mimicking legitimate Windows update CAB file.  |

 **Conclusion:** This screenshot confirms the malware payload stage, C2 endpoints, and decoy traffic patterns delivered over HTTP.

---

![Screenshot 2025-07-10 142948](https://github.com/user-attachments/assets/8fbb76e2-2bfa-4c74-9c37-35336d94d42e)


| **Observation**                  | **Explanation**                                                                 |
|----------------------------------|----------------------------------------------------------------------------------|
| IP: `147.45.47.98`               | Destination for encrypted TLS traffic â€” identified as SocGholish infrastructure.|
| TLSv1.3 Handshake + Application Data | Indicates browser downloaded encrypted payload or connected to C2 over HTTPS.    |
| TCP Flags (SYN, ACK, FIN, RST)   | Standard connection establishment/teardown. Shows completion of session.        |

**Conclusion:** TLS session with known malicious IP confirms encrypted malware delivery or C2 communication.

---

![Screenshot 2025-07-10 143123](https://github.com/user-attachments/assets/f0cf6377-3c9e-44d7-ad2f-0e4e30deb715)


| **Observation**                                              | **Explanation**                                                                 |
|--------------------------------------------------------------|----------------------------------------------------------------------------------|
| GET `/msdownload/update/.../pinrulessl1.cab`                 | Obfuscated CAB file delivered under disguise of Windows Update infrastructure.  |
| DNS to `ctldl.windowsupdate.com` â†’ `edgesuite.net`           | Domain masquerading. May seem valid, but edgesuite is used for CDN abuse.       |

**Conclusion:** This is a classic fake update download event typical in SocGholish-style infections.

---

The user visited a compromised site that redirected them via injected JavaScript to a **fake update page**, which downloaded malware. The infected system began **C2 communication**, confirming successful compromise.


---

### Step 3: Analyze Extracted Malware

- Extracted `Update.zip` to obtain `Update.js`
 ![image](https://github.com/user-attachments/assets/7a9120ed-460b-4558-850b-99262727b0d2)

- Opened `Update.js` in a text editor â€” found **heavily obfuscated code**

![image](https://github.com/user-attachments/assets/814ba14f-9879-4d14-b3cd-7818d0c6871e)

- Submitted SHA256 hash to VirusTotal â€” flagged as SocGholish(use this wesite https://www.virustotal.com/gui/home/upload)

![image](https://github.com/user-attachments/assets/ccbaa300-7fa3-4df5-8e5c-7f1cbd82b7fb)

#### VirusTotal Detection â€” `Update.js`

| Attribute             | Value |
|-----------------------|-------|
| **SHA256**            | `f8ee2a0ff206c40aac5b18030da151e8bbf1100d3a68d2b0cd24aff634d31cca` |
| **File Name**         | `Update.js` |
| **File Size**         | 4.22 KB |
| **Detection Rate**    | `23/61` vendors flagged as malicious |
| **Last Analysis Date**| ~4 months ago |
| **Threat Labels**     | `Trojan.JS.SOCGHOLISH.YXFBMZ`, `TrojanDownloader.Agent`, `Obfuscated` |
| **Threat Family**     | `SocGholish`, `YXFBMZ` |
| **Malware Type**      | `Trojan`, `Downloader`, `JavaScript` |

### ðŸ›¡ Vendors That Detected This File
- **Microsoft:** `Trojan:JS/Obfus!MSR`
- **Kaspersky:** `HEUR:Trojan.Script.Generic`
- **ESET-NOD32:** `JS/TrojanDownloader.Agent.ABYX`
- **TrendMicro:** `Trojan.JS.SOCGHOLISH.YXFBMZ`
- **Symantec:** `Trojan.Gen.MBT`
- **BitDefender / GData / Emsisoft / VIPRE:** `Trojan.Generic.37425641`
- **Tencent:** `Js.Trojan-Downloader.Er.Qcnw`
- **Google:** Detected as malicious

Some vendors were **unable to process JavaScript file type**, which is common with `.js` samples.

The JavaScript file is confirmed to be part of the **SocGholish malware family**. It is a **malicious downloader**, often used to install additional payloads such as **PowerShell-based malware (KongTuke)**.

---

###  Step 4: Extract Indicators of Compromise (IOCs)


| Type             | Value |
|------------------|-------|
| **Domains**      | `sesraw.com`, `fmnljjmaeihehge.top` |
| **IPs**          | `147.45.47.98`, `45.61.136.218`, `86.107.101.93` |
| **File Hashes**  | `f8ee2a0ff206c40aac5b18030da151e8bbf1100d3a68d2b0cd24aff634d31cca` (`Update.js`) |
| **Scheduled Tasks** | `Google_Maintenance_Worker`, `Get-MpPreference` |
| **Dropped Files**   | `Update.js`, `.pfx` certificate payloads |
| **Ports Used**      | `25658` (TLS beaconing) |
| **Malware Family**  | `SocGholish`, `KongTuke` |
| **DNS Masquerading** | `ctldl.windowsupdate.com â†’ edgesuite.net` (Akamai CDN abuse) |

These artifacts are **high-confidence IOCs** for detection, threat hunting, and automated remediation across environments. They confirm the use of **browser-based malware delivery**, **fake update schemes**, and **PowerShell-based persistence**.

---


### Step 5: Simulate Incident Detection (SOC Alert)

####  What Was Simulated
- An internal user reported a suspicious "browser update" popup while visiting a legitimate-looking site.
- Endpoint Detection and Response (EDR) flagged **PowerShell activity** repeating every 3 minutes.
- DNS filtering logs showed outbound queries to **`fmnljjmaeihehge[.]top`** and **`sesraw.com`**, both known C2 domains.
####  What Happened
- Alert triggered on **`Google_Maintenance_Worker`** (malicious Scheduled Task).
- Analyst noticed **PowerShell execution** and connections to `.top` domains.
- Investigation tied back to **`Update.js`** (SocGholish), which dropped additional payloads and maintained persistence.

#### What It Means
This activity confirms:
- **User-based social engineering** via fake browser updates
- **Active infection with persistence**
- **C2 beaconing using encrypted TLS (Port 25658)**

---



### Step 6: Apply the Incident Response Lifecycle

#### 6.1 Preparation
- EDR and SIEM deployed across all endpoints
- Analysts trained to recognize malware in JavaScript, scheduled task abuse, and fake update lures
- DNS filtering with known-bad TLDs (e.g., `.top`, `.xyz`) flagged

---

#### 6.2 Identification
**How it was detected:**
- Suspicious Scheduled Task (`Google_Maintenance_Worker`)
- Obfuscated PowerShell command in WMI logs
- PCAP evidence of TLS connections to:
  - `147.45.47.98`
  - `fmnljjmaeihehge[.]top`
- File hash match for `Update.js` on VirusTotal (SHA256)

---

#### 6.3 Containment
**Actions Taken:**
- Isolated the infected workstation from network
- Blocked:
  - IPs: `147.45.47.98`, `45.61.136.218`
  - Domains: `*.top`, `sesraw.com`
  - Port: `25658` (suspicious TLS channel)
- Disabled and removed:
  - Scheduled Tasks (`Google_Maintenance_Worker`)
  - Malicious scripts in AppData

---

#### 6.4 Eradication
**Actions Taken:**
- Deleted:
  - `Update.js` and downloaded secondary payloads
  - `.pfx` files used for masqueraded certificates
- Registry cleaned of auto-start entries and encoded payloads
- All PowerShell logs exported for forensic timeline

---

#### 6.5 Recovery
**Actions Taken:**
- Reimaged the infected system using gold image
- Restored user files from backup (after scan)
- Rotated passwords for affected accounts
- Confirmed removal via:
  - EDR sweep
  - DNS and SIEM queries
  - Scheduled task audit

---

#### 6.6 Lessons Learned
- Enforce browser hardening and disable script execution where possible
- Deploy more aggressive DNS filtering, including reputation-based blocking
- Create a YARA/Sigma rule for SocGholish-style JS + PowerShell combo
- Train end users on fake browser update lures

---

### Step 7: Timeline and Reporting

#### ðŸ“… Incident Timeline

| Time (UTC)       | Event |
|------------------|-------|
| 2025-01-28 14:02 | User visited compromised website |
| 2025-01-28 14:03 | JavaScript redirect to fake browser update |
| 2025-01-28 14:04 | `Update.js` downloaded (SHA256: `f8ee2a0f...`) |
| 2025-01-28 14:05 | `Google_Maintenance_Worker` scheduled |
| 2025-01-28 14:06 | TLS beacon to `147.45.47.98` via Port 25658 |
| 2025-01-28 14:07 | PCAP shows GET `/pinrulessl1.cab` |
| 2025-01-29 01:35 | Repeated beaconing to `fmnljjmaeihehge[.]top` |
| 2025-01-29 02:00 | Host isolated, IR initiated |

---
